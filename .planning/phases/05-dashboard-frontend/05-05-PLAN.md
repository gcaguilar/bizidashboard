---
phase: 05-dashboard-frontend
plan: 05
type: execute
wave: 3
depends_on: ["02"]
files_modified: [src/app/dashboard/_components/HourlyCharts.tsx, src/app/dashboard/_components/Heatmap.tsx, src/app/dashboard/_components/DashboardClient.tsx, src/lib/format.ts]
autonomous: true

must_haves:
  truths:
    - "Graficas comparan patrones por hora entre semana y fin de semana"
    - "Heatmap muestra ocupacion por hora y dia"
    - "Cambiar estacion actualiza patrones y heatmap sin recargar"
  artifacts:
    - path: "src/app/dashboard/_components/HourlyCharts.tsx"
      provides: "Graficas comparativas por hora"
      exports: ["HourlyCharts"]
    - path: "src/app/dashboard/_components/Heatmap.tsx"
      provides: "Heatmap por hora y dia"
      exports: ["Heatmap"]
    - path: "src/app/dashboard/_components/DashboardClient.tsx"
      provides: "Estado de estacion y datos reactivos"
      exports: ["DashboardClient"]
  key_links:
    - from: "src/app/dashboard/_components/HourlyCharts.tsx"
      to: "src/lib/format.ts"
      via: "formatDayType"
      pattern: "formatDayType"
    - from: "src/app/dashboard/_components/Heatmap.tsx"
      to: "src/lib/format.ts"
      via: "formatPercent"
      pattern: "formatPercent"
    - from: "src/app/dashboard/_components/DashboardClient.tsx"
      to: "/api/patterns"
      via: "fetch on selectedStationId change"
      pattern: "patterns"
    - from: "src/app/dashboard/_components/DashboardClient.tsx"
      to: "/api/heatmap"
      via: "fetch on selectedStationId change"
      pattern: "heatmap"
---

<objective>
Completar las visualizaciones de patrones horarios y heatmap con Recharts y reaccionar al cambio de estacion.

Purpose: Mostrar patrones claros de uso por hora y dia, y actualizar las graficas al seleccionar otra estacion.
Output: Graficas de patrones y heatmap integrados con datos reactivos y layout responsivo.
</objective>

<execution_context>
@/home/guichu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/guichu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard-frontend/05-RESEARCH.md
@src/app/dashboard/_components/DashboardClient.tsx
@src/app/dashboard/_components/HourlyCharts.tsx
@src/app/dashboard/_components/Heatmap.tsx
@src/lib/format.ts
@src/analytics/queries/read.ts
@src/analytics/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implementar graficas de patrones por hora</name>
  <files>src/app/dashboard/_components/HourlyCharts.tsx, src/lib/format.ts</files>
  <action>
Implementa `HourlyCharts` con Recharts usando `ResponsiveContainer` y `LineChart`. Transforma la data de `patterns` a 24 puntos con series para "Entre semana" y "Fin de semana" (usa `dayType` para agrupar). Grafica `occupancyAvg` (o porcentaje equivalente) y agrega tooltip en espanol. Incluye titulos y leyenda clara, sin estado de carga inicial.
  </action>
  <verify>npm run lint</verify>
  <done>La grafica compara entre semana vs fin de semana con datos reales y textos en espanol.</done>
</task>

<task type="auto">
  <name>Task 2: Implementar heatmap por hora y dia</name>
  <files>src/app/dashboard/_components/Heatmap.tsx, src/lib/format.ts</files>
  <action>
Implementa `Heatmap` con Recharts `ScatterChart` y un `shape` custom cuadrado para cada celda (hora x dia). Mapea `dayOfWeek` a etiquetas en espanol (Lun-Dom) y usa un gradiente de color segun `occupancyAvg`. Agrega tooltip en espanol con hora, dia y porcentaje. Mantiene el render inicial sin estados de carga.
  </action>
  <verify>npm run lint</verify>
  <done>El heatmap muestra ocupacion por hora y dia con una escala de color legible.</done>
</task>

<task type="auto">
  <name>Task 3: Refrescar patrones/heatmap al cambiar estacion y ajustar layout</name>
  <files>src/app/dashboard/_components/DashboardClient.tsx</files>
  <action>
En `DashboardClient`, guarda `patterns` y `heatmap` en estado local inicializado desde `initialData`. Cuando cambie `selectedStationId`, dispara un `useEffect` que consulte `/api/patterns?stationId=...` y `/api/heatmap?stationId=...` (mismo formato que los datos iniciales), actualizando el estado para alimentar `HourlyCharts` y `Heatmap`. Mantiene los datos anteriores visibles mientras se refresca (sin spinner global) y muestra, si quieres, una marca sutil de "Actualizando" cerca de las graficas. Refina el layout para que las tarjetas se distribuyan en 2-3 columnas en desktop y una columna en movil, con jerarquia visual clara y fondos diferenciados.
  </action>
  <verify>npm run lint</verify>
  <done>Cambiar de estacion actualiza las graficas y heatmap sin recargar la pagina y el layout es responsivo.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

<success_criteria>
- Graficas de patrones y heatmap visibles y coherentes con los datos.
- Cambiar estacion actualiza patrones/heatmap sin recarga ni estados de carga agresivos.
- Layout responsivo con jerarquia visual clara en movil y desktop.
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-frontend/05-05-SUMMARY.md`
</output>
