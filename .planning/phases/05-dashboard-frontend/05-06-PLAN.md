---
phase: 05-dashboard-frontend
plan: 06
type: execute
wave: 4
depends_on: ["03", "04", "05"]
files_modified: [next.config.ts, Dockerfile, .dockerignore]
autonomous: false
user_setup:
  - service: coolify
    why: "Public deployment for the dashboard"
    env_vars:
      - name: DATABASE_URL
        source: "Coolify environment variables for the app"
      - name: REDIS_URL
        source: "Coolify environment variables for the app"
      - name: NODE_ENV
        source: "Set to production in Coolify"
    dashboard_config:
      - task: "Create new app and attach domain"
        location: "Coolify UI"
      - task: "Set build and start commands"
        location: "Coolify UI -> Build & Deploy"

must_haves:
  truths:
    - "El dashboard publico responde en una URL sin autenticacion"
    - "El build standalone de Next.js esta listo para produccion"
  artifacts:
    - path: "Dockerfile"
      provides: "Imagen de produccion para Next.js"
      contains: "next build"
    - path: "next.config.ts"
      provides: "Config de build standalone"
      contains: "output: 'standalone'"
  key_links:
    - from: "next.config.ts"
      to: "Dockerfile"
      via: "standalone build"
      pattern: "standalone"
---

<objective>
Preparar el despliegue publico del dashboard y publicar la URL.

Purpose: Cumplir INFRA-05 con un despliegue accesible sin autenticacion.
Output: Configuracion de build y despliegue en Coolify.
</objective>

<execution_context>
@/home/guichu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/guichu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@next.config.ts
@package.json
@src/lib/db.ts
@src/lib/cache/redis.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configurar build standalone y Dockerfile de produccion</name>
  <files>next.config.ts, Dockerfile, .dockerignore</files>
  <action>
Actualiza `next.config.ts` con `output: 'standalone'` y `poweredByHeader: false`. Crea un `Dockerfile` multi-stage para Next.js que: instala dependencias, corre `npm run build`, y en la imagen final copia `.next/standalone`, `.next/static` y `public`, exponiendo el puerto 3000 y usando `node server.js` como comando. Agrega `.dockerignore` para excluir `node_modules`, `.next`, `dev.db`, `.env` y `tests`.
  </action>
  <verify>npm run build</verify>
  <done>El proyecto genera build standalone y existe un Dockerfile listo para produccion.</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Publicar el dashboard en Coolify</action>
  <instructions>
1) En Coolify, crea una nueva app desde este repositorio y selecciona Dockerfile como build.
2) Configura variables de entorno: `DATABASE_URL`, `REDIS_URL`, `NODE_ENV=production`.
3) Define el puerto 3000 y asigna un dominio publico.
4) Lanza el despliegue y confirma que la URL responde.
  </instructions>
  <resume-signal>Escribe "listo" y comparte la URL publica, o describe cualquier error.</resume-signal>
</task>

</tasks>

<verification>
- `npm run build`
- URL publica responde con HTTP 200
</verification>

<success_criteria>
- Deploy publico accesible sin autenticacion.
- Build standalone y Dockerfile listos para produccion.
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-frontend/05-06-SUMMARY.md`
</output>
