---
phase: 05-dashboard-frontend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [package.json, package-lock.json, src/app/layout.tsx, src/app/globals.css, src/app/page.tsx, src/lib/api.ts, src/lib/format.ts]
autonomous: true

must_haves:
  truths:
    - "La ruta `/` redirige a `/dashboard`"
    - "La interfaz base usa textos en espanol y tipografias definidas"
    - "El dashboard cuenta con estilos base y fondo definidos"
    - "El servidor puede obtener datos del dashboard via helpers"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Layout base en espanol con tipografias expresivas"
      exports: ["metadata"]
    - path: "src/app/globals.css"
      provides: "Variables de color y estilos base del dashboard"
      contains: ":root"
    - path: "src/app/page.tsx"
      provides: "Redirect publico a /dashboard"
      exports: ["default"]
    - path: "src/lib/api.ts"
      provides: "Fetchers server-side para endpoints del dashboard"
      exports: ["fetchStations", "fetchRankings", "fetchAlerts", "fetchStatus", "fetchPatterns", "fetchHeatmap"]
    - path: "src/lib/format.ts"
      provides: "Formateo en espanol y helpers de etiquetas"
      exports: ["formatRelativeMinutes", "formatAlertType", "formatDayType", "formatPercent"]
  key_links:
    - from: "src/lib/api.ts"
      to: "/api/stations"
      via: "fetchStations"
      pattern: "fetchStations"
    - from: "src/lib/api.ts"
      to: "/api/rankings"
      via: "fetchRankings"
      pattern: "fetchRankings"
    - from: "src/lib/api.ts"
      to: "/api/patterns"
      via: "fetchPatterns"
      pattern: "fetchPatterns"
    - from: "src/lib/api.ts"
      to: "/api/heatmap"
      via: "fetchHeatmap"
      pattern: "fetchHeatmap"
    - from: "src/lib/api.ts"
      to: "/api/alerts"
      via: "fetchAlerts"
      pattern: "fetchAlerts"
    - from: "src/lib/api.ts"
      to: "/api/status"
      via: "fetchStatus"
      pattern: "fetchStatus"
---

<objective>
Establecer dependencias, estilo base y helpers server-side en espanol.

Purpose: Asegurar un render inicial consistente, textos en espanol y utilidades reutilizables.
Output: Dependencias instaladas, layout/estilos base y helpers de datos/formatos.
</objective>

<execution_context>
@/home/guichu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/guichu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-dashboard-frontend/05-RESEARCH.md
@src/app/layout.tsx
@src/app/globals.css
@src/app/page.tsx
@src/app/api/stations/route.ts
@src/app/api/rankings/route.ts
@src/app/api/patterns/route.ts
@src/app/api/heatmap/route.ts
@src/app/api/alerts/route.ts
@src/app/api/status/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Instalar dependencias y definir base visual</name>
  <files>package.json, package-lock.json, src/app/layout.tsx, src/app/globals.css, src/app/page.tsx</files>
  <action>
Instala `recharts`, `react-is`, `react-map-gl` y `maplibre-gl` como dependencias. Actualiza `src/app/layout.tsx` para usar tipografias expresivas (por ejemplo `Manrope` para texto y `IBM_Plex_Mono` para datos), cambiar `html lang` a `es`, y fijar metadata en espanol (titulo y descripcion). Ajusta `src/app/globals.css` con variables de color propias, fondo con gradiente sutil y tipografia base usando las variables de fuente; evita el estilo dark-mode por defecto del template. Sustituye el contenido de `src/app/page.tsx` por un redirect a `/dashboard` usando `redirect` de `next/navigation` para que la URL publica muestre el dashboard.
  </action>
  <verify>npm run lint</verify>
  <done>Dependencias instaladas, layout en espanol, estilos base definidos y `/` redirige a `/dashboard`.</done>
</task>

<task type="auto">
  <name>Task 2: Crear helpers server-side de datos y formatos en espanol</name>
  <files>src/lib/api.ts, src/lib/format.ts</files>
  <action>
Crea `src/lib/api.ts` con `import 'server-only'` y helpers tipados para llamar a `/api/stations`, `/api/rankings`, `/api/alerts`, `/api/status`, `/api/patterns` y `/api/heatmap` usando `fetch` con `{ cache: 'no-store' }`. Construye la base URL desde `headers()` (`x-forwarded-proto` y `host`) para llamadas server-side. Incluye validaciones basicas y errores claros si la respuesta no es 200. Crea `src/lib/format.ts` con helpers en espanol: formateo de minutos transcurridos, etiquetas de `DayType`, nombres de alertas, porcentaje con 0-100 y fallback seguro.
  </action>
  <verify>npm run lint</verify>
  <done>Existen helpers server-side para todos los endpoints y utilidades de formato en espanol reutilizables.</done>
</task>

</tasks>

<verification>
- `npm run lint`
</verification>

<success_criteria>
- Dependencias de mapas y graficas instaladas y layout en espanol aplicado.
- Helpers de datos y formato disponibles para el dashboard.
</success_criteria>

<output>
After completion, create `.planning/phases/05-dashboard-frontend/05-01-SUMMARY.md`
</output>
